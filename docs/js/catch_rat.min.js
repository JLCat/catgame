"use strict";var polifill=function(){for(var t=0,a=["ms","moz","webkit","o"],e=0;e<a.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[a[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[a[e]+"CancelAnimationFrame"]||window[a[e]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a,e){var n=(new Date).getTime(),o=Math.max(0,16-(n-t)),r=window.setTimeout(function(){a(n+o)},o);return t=n+o,r}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})},canvas=null,context=null,pause=!1,border=10,frameRate=1e3/60,frames=[],frame=0,now=null,then=Date.now(),delta=null,assets=["imgs/001.png","imgs/002.png","imgs/002.png","imgs/003.png","imgs/003.png","imgs/002.png","imgs/002.png","imgs/001.png"],rat={x:window.innerWidth/2,y:window.innerHeight/2,a:0,dx:0,dy:0,da:0,runSpeed:5,rotateSpeed:10},coordinate={x:window.innerWidth/2,y:window.innerHeight/2},onImageLoad=function(){console.log("Image loaded!")},Sprite=function(t){var a=this;this.image=null,this.pattern=null,this.TO_RADIANS=Math.PI/180,void 0!=t&&""!=t&&null!=t?(this.image=new Image,this.image.onload=onImageLoad,this.image.src=t):console.log("Image "+t+" not found!"),this.draw=function(t,e,n){context.drawImage(a.image,t,e,n,n)},this.rotate=function(t,e,n,o){context.save(),context.translate(t,e),context.rotate(o*a.TO_RADIANS),context.drawImage(a.image,-n/2,-n/2,n,n),context.restore()}},setup=function(){canvas=document.getElementById("canvas"),context=canvas.getContext("2d"),canvas.width=window.innerWidth,canvas.height=window.innerHeight;for(var t=0;t<assets.length;t++)frames.push(new Sprite(assets[t]))},tick=function t(){pause||(requestAnimationFrame(t),now=Date.now(),(delta=now-then)>frameRate&&(then=now-delta%frameRate,animate()))},clearScreen=function(){context.clearRect(0,0,canvas.width,canvas.height)},randomCoordinate=function(){coordinate.x=border+Math.round(Math.random()*(window.innerWidth-2*border)),coordinate.y=border+Math.round(Math.random()*(window.innerHeight-2*border))},getSpeed=function(t,a,e,n){var o=e-t,r=n-a,i=Math.sqrt(Math.pow(o,2)+Math.pow(r,2));return[o/(i/rat.runSpeed),r/(i/rat.runSpeed)]},getAngle=function(t,a,e,n){var o=Math.abs(t-e),r=Math.abs(a-n),i=r/Math.sqrt(Math.pow(o,2)+Math.pow(r,2)),d=Math.acos(i),s=Math.floor(180/(Math.PI/d));return e>t&&n>a&&(s=180-s),e<t&&n>a&&(s=180+s),e<t&&n<a&&(s=360-s),e>t&&n<a&&(s=s),e==t&&n>a&&(s=180),e==t&&n<a&&(s=0),e>t&&n==a&&(s=90),e<t&&n==a&&(s=360),s},animate=function(){clearScreen();var t=Math.max(window.innerWidth,window.innerHeight)/5,a=t/2,e=rat.x-a,n=rat.y-a,o={left:e,right:e+t,top:n,buttom:n+t};coordinate.x>o.left&&coordinate.x<o.right&&coordinate.y>o.top&&coordinate.y<o.buttom&&randomCoordinate();var r=getAngle(rat.x,rat.y,coordinate.x,coordinate.y),i=getSpeed(rat.x,rat.y,coordinate.x,coordinate.y),d=r-rat.a;0==d?(rat.dx=i[0],rat.dy=i[1],rat.da=0):(Math.abs(d)>rat.rotateSpeed?rat.da=d>0?rat.rotateSpeed:-rat.rotateSpeed:rat.da=d,rat.dx=0,rat.dy=0),rat.x+=rat.dx,rat.y+=rat.dy,rat.a+=rat.da,frames[frame].rotate(rat.x,rat.y,t,rat.a),frame=(frame+1)%frames.length},gameStart=function(){pause=!1,tick()},gameStop=function(){pause=!0},gameListener=function(){var t=$(".control-button");t.click(function(){t.hasClass("start")?gameStart():gameStop(),t.toggleClass("start"),t.toggleClass("stop")})};$(document).ready(function(){polifill(),setup(),gameListener()}),$(window).resize(function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight});